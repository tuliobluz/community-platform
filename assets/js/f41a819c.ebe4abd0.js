"use strict";(self.webpackChunkoa_docs=self.webpackChunkoa_docs||[]).push([[716],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),d=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=d(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},f=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=d(n),f=a,m=p["".concat(l,".").concat(f)]||p[f]||u[f]||i;return n?r.createElement(m,o(o({ref:t},c),{},{components:n})):r.createElement(m,o({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=f;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:a,o[1]=s;for(var d=2;d<i;d++)o[d]=n[d];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}f.displayName="MDXCreateElement"},5994:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>d});var r=n(7462),a=(n(7294),n(3905));const i={},o="E2E Testing",s={unversionedId:"Testing/end-to-end",id:"Testing/end-to-end",title:"E2E Testing",description:"End-to-end testing is carried out by Cypress, and executed against a dedicated firebase project (different to development and staging).",source:"@site/docs/Testing/end-to-end.md",sourceDirName:"Testing",slug:"/Testing/end-to-end",permalink:"/Testing/end-to-end",draft:!1,editUrl:"https://github.com/ONEARMY/community-platform/edit/master/packages/documentation/docs/Testing/end-to-end.md",tags:[],version:"current",frontMatter:{},sidebar:"mainSidebar",previous:{title:"Testing Overview",permalink:"/Testing/overview"},next:{title:"Deployment via CircleCI",permalink:"/Deployment/circle-ci"}},l={},d=[{value:"Getting Started",id:"getting-started",level:2},{value:"Data Seeding",id:"data-seeding",level:3},{value:"CI testing",id:"ci-testing",level:3},{value:"Parallel testing",id:"parallel-testing",level:3},{value:"Browser testing",id:"browser-testing",level:3},{value:"Database tear down",id:"database-tear-down",level:3}],c={toc:d},p="wrapper";function u(e){let{components:t,...i}=e;return(0,a.kt)(p,(0,r.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"e2e-testing"},"E2E Testing"),(0,a.kt)("p",null,"End-to-end testing is carried out by ",(0,a.kt)("a",{parentName:"p",href:"https://www.cypress.io/"},"Cypress"),", and executed against a dedicated firebase project (different to development and staging)."),(0,a.kt)("p",null,"You will notice the data in test is completely different to what you see when developing. In addition, the testing app starts at the port ",(0,a.kt)("inlineCode",{parentName:"p"},"localhost:3456")," which all tests are run against."),(0,a.kt)("p",null,"The tests are not comprehensive, but are slowly being built over time - particularly when bugs are noticed. Therefore if you identify a bug, before fixing it is recommended to add a test so that the bug is less likely to resurface in the future."),(0,a.kt)("h2",{id:"getting-started"},"Getting Started"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"yarn workspace oa-cypress install\nyarn workspace oa-cypress start\n")),(0,a.kt)("p",null,"(or shorthand ",(0,a.kt)("inlineCode",{parentName:"p"},"yarn test"),")"),(0,a.kt)("h3",{id:"data-seeding"},"Data Seeding"),(0,a.kt)("p",null,"A standard set of database documents are created at the start of every test and cleared at the end. These are populated from the ",(0,a.kt)("inlineCode",{parentName:"p"},"fixtures/seed")," folder to the online firebase firestore database."),(0,a.kt)("p",null,"They will be automatically deleted after tests have completed running"),(0,a.kt)("h3",{id:"ci-testing"},"CI testing"),(0,a.kt)("p",null,"Tests are automatically run on every pull request, and can be viewed on the cypress dashboard. A link to the specific test run will be populated into the PR, or publicly viewable at: ",(0,a.kt)("a",{parentName:"p",href:"https://dashboard.cypress.io/projects/4s5zgo/runs"},"https://dashboard.cypress.io/projects/4s5zgo/runs")),(0,a.kt)("h3",{id:"parallel-testing"},"Parallel testing"),(0,a.kt)("p",null,"When testing is initiated a random prefix is generated to uniquely seed/clear the database (e.g. ",(0,a.kt)("inlineCode",{parentName:"p"},"test1_howtos")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"test2_howtos"),") and avoid different tests interfering with each other. This allows us to test multiple specs in parallel when running on ci."),(0,a.kt)("h3",{id:"browser-testing"},"Browser testing"),(0,a.kt)("p",null,"Currently testing is carried out against chrome(stable) and firefox(latest) browsers. We are not able to support any additional browsers (e.g. safari) via ci as they are not currently supported by cypress. If this changes in the future then it would be good to add. See discussion around this here: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/ONEARMY/community-platform/issues/611"},"https://github.com/ONEARMY/community-platform/issues/611")),(0,a.kt)("h3",{id:"database-tear-down"},"Database tear down"),(0,a.kt)("p",null,"In case of test fail, documents will not be deleted from the server. This is not a major issue as they all are randomly prefixed, and will just sit in the database. From time-to-time admins may decide to delete any hanging data via the firebase cli."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"firebase use ci\nfirebase firestore:delete --all-collections\n")),(0,a.kt)("admonition",{type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"The command will completely wipe the database, and so should only be used on the ci project when required. If needing access to the ci project ask one of the platform admins who can send an invite\nDO NOT USE AGAINST STAGING OR PRODUCTION SITES!!!")),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"CI Project - firestore with uncleared data"),"\n",(0,a.kt)("img",{src:n(8311).Z,width:"1266",height:"679"})))}u.isMDXComponent=!0},8311:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/ci-firestore-project-5867572f45ff542d10f8b52baf1ed611.png"}}]);