"use strict";(self.webpackChunkoa_docs=self.webpackChunkoa_docs||[]).push([[225],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=o.createContext({}),l=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=l(e.components);return o.createElement(c.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=l(n),m=r,f=p["".concat(c,".").concat(m)]||p[m]||d[m]||a;return n?o.createElement(f,i(i({ref:t},u),{},{components:n})):o.createElement(f,i({ref:t},u))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[p]="string"==typeof e?e:r,i[1]=s;for(var l=2;l<a;l++)i[l]=n[l];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9891:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var o=n(7462),r=(n(7294),n(3905));const a={id:"integrations",title:"Integrations"},i=void 0,s={unversionedId:"Backend Development/integrations",id:"Backend Development/integrations",title:"Integrations",description:"Integrations with 3rd party services can be handled by the functions backend. Any number of triggers can be used, including Cloud Firestore (database) Triggers, HTTP, and cron Triggers.",source:"@site/docs/Backend Development/integrations.md",sourceDirName:"Backend Development",slug:"/Backend Development/integrations",permalink:"/Backend Development/integrations",draft:!1,editUrl:"https://github.com/ONEARMY/community-platform/edit/master/packages/documentation/docs/Backend Development/integrations.md",tags:[],version:"current",frontMatter:{id:"integrations",title:"Integrations"},sidebar:"mainSidebar",previous:{title:"Firestore DB Backup",permalink:"/Backend Development/firestore-backup"},next:{title:"Tests",permalink:"/Backend Development/tests"}},c={},l=[{value:"Examples",id:"examples",level:2},{value:"Post to slack on new howTo, event or map pin",id:"post-to-slack-on-new-howto-event-or-map-pin",level:3},{value:"Link user account to Patreon",id:"link-user-account-to-patreon",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Development",id:"development",level:2}],u={toc:l},p="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(p,(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Integrations with 3rd party services can be handled by the ",(0,r.kt)("inlineCode",{parentName:"p"},"functions")," backend. Any number of triggers can be used, including Cloud Firestore (database) Triggers, HTTP, and cron Triggers."),(0,r.kt)("h2",{id:"examples"},"Examples"),(0,r.kt)("h3",{id:"post-to-slack-on-new-howto-event-or-map-pin"},"Post to slack on new howTo, event or map pin"),(0,r.kt)("p",null,"This uses the ",(0,r.kt)("a",{parentName:"p",href:"https://firebase.google.com/docs/functions/firestore-events"},"firestore document triggers")," to recognise new database entries and make a http post to slack which uses a ",(0,r.kt)("a",{parentName:"p",href:"https://api.slack.com/messaging/webhooks"},"webhooks")," to add messages to a designated slack channel."),(0,r.kt)("p",null,"The full code can be seen at ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ONEARMY/community-platform/blob/master/functions/src/Integrations/firebase-slack.ts"},(0,r.kt)("inlineCode",{parentName:"a"},"functions\\src\\Integrations\\firebase-slack.ts"))," and exposed in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ONEARMY/community-platform/blob/master/functions/src/index.ts"},(0,r.kt)("inlineCode",{parentName:"a"},"functions\\src\\index.ts"))),(0,r.kt)("h3",{id:"link-user-account-to-patreon"},"Link user account to Patreon"),(0,r.kt)("p",null,"This uses an ",(0,r.kt)("a",{parentName:"p",href:"functions/src/Integrations/patreon.ts"},"HTTP endpoint")," to communicate with the Patreon API. This should be done server-side to protect sensitive keys and auth codes. The endpoint is called from the frontend with a single-use access token. The token is used to grant an access code that we pass in to other Patreon API endpoints for authentication."),(0,r.kt)("p",null,"When a human links their Patreon account with the Community Platform, we access their Patreon user information from the Patreon API and store it in the users collection. We store sensitive access codes in the user_integrations collection which has stricter security rules."),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"Sometimes specific urls/api_keys need to be stored to use with the service. Rather than storing this values in code we are using config variables. This keeps them out of version control and prevents them being public."),(0,r.kt)("p",null,"To work with the ",(0,r.kt)("a",{parentName:"p",href:"https://firebase.google.com/docs/functions/config-env#migrating_from_environment_configuration"},"environment configuration")," you will need to be authenticated via the CLI and have edit access to the target Firebase instance."),(0,r.kt)("p",null,"Inspect the configuration on the current instance, this will return all values that have been set as an object."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"firebase functions:config:get\n")),(0,r.kt)("p",null,"Store values on the instance"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"firebase functions:config:set documentation=amazing\n\n# You can set values in a nested object using dot notation\nfirebase functions:config:set nested.path=value\n")),(0,r.kt)("p",null,"The implementation is at ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ONEARMY/community-platform/blob/master/functions/src/config/config.ts"},(0,r.kt)("inlineCode",{parentName:"a"},"functions/src/config/config.ts")),"."),(0,r.kt)("h2",{id:"development"},"Development"),(0,r.kt)("p",null,"Contact a maintainer in order to access the config variables needed to test these integrations locally. Or, set up your own test account on the integration platform and and generate keys to play with! Just remember not to remove any sensitive info before pushing to Github \ud83e\udd2b"))}d.isMDXComponent=!0}}]);